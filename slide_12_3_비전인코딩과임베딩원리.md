# 슬라이드 12-3: 비전 인코딩과 임베딩 원리

**리딩 메시지**: "이미지를 컴퓨터가 이해할 수 있는 숫자 언어로 변환하는 과정을 이해하면 멀티모달 AI의 핵심을 파악할 수 있습니다"

## 비전 인코딩의 목적

### 변환 과정
- **입력**: H×W×C 픽셀 (문서 이미지)
- **출력**: LLM이 처리할 수 있는 시각 토큰 시퀀스 (길이 N, 차원 d)
- **역할**: 위치(레이아웃)와 형태(글리프) 정보를 최대한 보존하며 토큰화

## CNN vs ViT 인코딩 방식 차이

### CNN (Convolutional Neural Network)
```
픽셀값 → 작은 커널(3×3)로 슬라이딩 → 특징맵 생성
- 시작: 원본 RGB 픽셀값 (0-255 또는 0-1)
- 처리: 필터로 색 변화, 엣지, 모서리, 선의 방향 감지
- 결과: 저수준(가로선, 세로선) → 고수준(글자 형태) 특징 추상화
```

### ViT (Vision Transformer)
```
픽셀값 → P×P 패치로 분할 → 토큰화 → Self-Attention
- 패치 분할: 이미지를 14×14 픽셀 블록으로 자름
- 토큰화: 각 패치를 하나의 벡터로 평탄화(flatten)
- 위치 인코딩: 패치의 (x,y) 좌표 정보 추가
- Self-Attention: 모든 패치 간 관계를 한 번에 계산
```

## 픽셀을 숫자로 변환하는 정보들

### 1. 기본 색상 정보
- **RGB 값**: 빨강(R), 초록(G), 파랑(B) 채널 (0~255)
- **정규화**: 0-255를 0-1 사이 실수로 변환해 계산 안정화

### 2. 모양·경계 정보
- **에지 강도**: 픽셀 주변의 색 변화량 (Sobel 필터, Canny 에지)
- **방향성**: 선이 가로/세로/대각선인지 판단
- **글자 획 구분**: ㅏ, ㅓ, ㄱ, ㄴ 등 구별에 중요

### 3. 질감·패턴 정보
- **패턴 반복성**: 글자 획의 두께, 점선, 질감
- **주파수 성분**: 고주파(세부 디테일), 저주파(큰 형태) 분리

### 4. 공간·위치 정보
- **절대 좌표**: 이미지 내에서의 (x, y) 위치
- **상대 위치**: 다른 패치들과의 관계

## 임베딩 공간에서의 유사성 판단

### 벡터 공간에서의 거리 계산
- **코사인 유사도**: 벡터 간 각도로 유사성 측정
- **유클리드 거리**: 직선 거리로 차이 계산
- **같은 글자의 패치들**: 임베딩 공간에서 서로 가깝게 위치
- **다른 글자의 패치들**: 서로 멀리 떨어져 위치

### 실제 예시
```python
# 간단한 패치 임베딩 예시
def patch_embedding(patch_pixels):
    # 1. 픽셀값 정규화
    normalized = patch_pixels / 255.0
    
    # 2. 선형 변환으로 임베딩 차원으로 변환
    embedding = linear_projection(normalized)  # 예: 768차원
    
    # 3. 위치 인코딩 추가
    position_encoding = get_2d_position_encoding(patch_x, patch_y)
    final_embedding = embedding + position_encoding
    
    return final_embedding
```

## 문서 AI에서의 활용

### 전통 OCR과의 차이
- **전통 OCR**: 라인별로 자른 후 시퀀스화 → 문자 클래스 직접 예측
- **비전 인코딩**: 페이지 전체를 패치 토큰으로 시퀀스화 → LLM이 자연어 생성

### 최적화 포인트
- **해상도 vs 토큰 수**: 높은 해상도는 더 많은 토큰 생성
- **패치 크기**: 작을수록 세밀하지만 계산량 증가
- **위치 보존**: 2D 구조를 1D 시퀀스로 변환 시 정보 손실 최소화

## 실무 고려사항

### 성능 최적화
- **작은 글자 문제**: 패치 크기보다 작은 글자는 인식 어려움
- **메모리 관리**: 큰 문서는 타일링으로 분할 처리
- **속도 개선**: Resampler로 토큰 수 압축

### 비용 효율성
- **토큰 수 제어**: 불필요한 패치 제거로 처리 비용 절감
- **적응적 해상도**: 중요 영역만 고해상도 처리

---

**강의 섹션**: 3. 기술요소 원리 (90분)
**슬라이드 번호**: 12-3/47
